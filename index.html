<script>
    // Discord Webhook URL
    const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1438795086937854014/s-BtKDQIXMlxJzElvEcNqjMbX4PP-U6WJeEmITflYFgamDFI0sFu9HzAMh-m5isTbiXR';
    
    // Debug logging
    function debugLog(message) {
        console.log('ðŸ” FGMRKT:', message);
    }

    // Genereer een unieke gebruikers-ID
    function generateUserId() {
        let userId = localStorage.getItem('fgmrkt_user_id');
        if (!userId) {
            userId = 'fg_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
            localStorage.setItem('fgmrkt_user_id', userId);
            debugLog('Nieuwe User ID aangemaakt: ' + userId);
        } else {
            debugLog('Bestaande User ID: ' + userId);
        }
        return userId;
    }
    
    // Verzamel gebruikersinformatie
    async function collectUserInfo() {
        const userId = generateUserId();
        
        // Verzamel browserinformatie
        const browserInfo = {
            userAgent: navigator.userAgent,
            language: navigator.language,
            platform: navigator.platform,
            screenWidth: screen.width,
            screenHeight: screen.height,
            colorDepth: screen.colorDepth,
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
        };
        
        // Probeer locatie te verkrijgen via meerdere services voor betere nauwkeurigheid
        let location = 'Onbekend';
        let locationService = 'Geen';
        
        try {
            // Probeer eerst ipapi.co (meest betrouwbaar)
            const response1 = await fetch('https://ipapi.co/json/');
            const data1 = await response1.json();
            location = `${data1.city}, ${data1.region}, ${data1.country_name} (${data1.postal})`;
            locationService = 'ipapi.co';
            debugLog('Locatie via ipapi.co: ' + location);
            
            // Voeg ISP/internet provider toe voor meer context
            if (data1.org) {
                location += ` | ${data1.org}`;
            }
            
        } catch (error) {
            debugLog('ipapi.co faalde: ' + error);
            
            // Fallback 1: ipgeolocation.io
            try {
                const response2 = await fetch('https://api.ipgeolocation.io/ipgeo?apiKey=demo');
                const data2 = await response2.json();
                location = `${data2.city}, ${data2.state_prov}, ${data2.country_name} (${data2.zipcode})`;
                locationService = 'ipgeolocation.io';
                debugLog('Locatie via ipgeolocation: ' + location);
            } catch (error2) {
                debugLog('ipgeolocation faalde: ' + error2);
                
                // Fallback 2: ipify
                try {
                    const response3 = await fetch('https://api.ipify.org?format=json');
                    const ipData = await response3.json();
                    location = `IP: ${ipData.ip} | Locatie onbekend`;
                    locationService = 'ipify';
                } catch (error3) {
                    location = 'Locatie niet beschikbaar';
                    locationService = 'geen';
                }
            }
        }
        
        // Verzamel extra netwerkinfo
        const connectionInfo = {
            effectiveType: navigator.connection ? navigator.connection.effectiveType : 'onbekend',
            downlink: navigator.connection ? navigator.connection.downlink + ' Mbps' : 'onbekend'
        };
        
        return {
            userId,
            browserInfo,
            location,
            locationService,
            connectionInfo,
            timestamp: new Date().toISOString(),
            page: window.location.href,
            referrer: document.referrer || 'Direct bezoek'
        };
    }
    
    // Stuur melding naar Discord
    async function sendToDiscord(userData) {
        if (!DISCORD_WEBHOOK_URL) {
            debugLog('âŒ Discord webhook URL niet ingesteld');
            return;
        }
        
        debugLog('ðŸ“¤ Verzenden naar Discord...');
        
        const embed = {
            title: 'ðŸš€ Nieuwe bezoeker op FGMRKT',
            color: 0x9932CC,
            fields: [
                {
                    name: 'ðŸ‘¤ Gebruikers-ID',
                    value: '`' + userData.userId + '`',
                    inline: false
                },
                {
                    name: 'ðŸ“ Locatie',
                    value: userData.location,
                    inline: true
                },
                {
                    name: 'ðŸŒ Locatie Service',
                    value: userData.locationService,
                    inline: true
                },
                {
                    name: 'ðŸ•’ Tijdstip',
                    value: new Date(userData.timestamp).toLocaleString('nl-NL'),
                    inline: true
                },
                {
                    name: 'ðŸ”— Referrer',
                    value: userData.referrer.substring(0, 50) + (userData.referrer.length > 50 ? '...' : ''),
                    inline: true
                },
                {
                    name: 'ðŸ’» Platform',
                    value: userData.browserInfo.platform,
                    inline: true
                },
                {
                    name: 'ðŸ—£ï¸ Taal',
                    value: userData.browserInfo.language,
                    inline: true
                },
                {
                    name: 'ðŸ“± Scherm',
                    value: `${userData.browserInfo.screenWidth}x${userData.browserInfo.screenHeight}`,
                    inline: true
                },
                {
                    name: 'â±ï¸ Timezone',
                    value: userData.browserInfo.timezone,
                    inline: true
                }
            ],
            timestamp: userData.timestamp,
            footer: {
                text: 'FGMRKT Tracker â€¢ ' + new Date().getFullYear()
            }
        };
        
        try {
            const response = await fetch(DISCORD_WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    embeds: [embed],
                    username: 'FGMRKT Tracker',
                    avatar_url: 'https://img.icons8.com/color/48/000000/rocket.png'
                })
            });
            
            if (response.ok) {
                debugLog('âœ… Succesvol verzonden naar Discord!');
            } else {
                debugLog('âŒ Fout bij verzenden: ' + response.status);
                debugLog('Response: ' + await response.text());
            }
        } catch (error) {
            debugLog('âŒ Fetch error: ' + error);
        }
    }
    
    // Verzamel en stuur gegevens wanneer de pagina geladen is
    document.addEventListener('DOMContentLoaded', async () => {
        // Wacht even zodat de pagina volledig geladen is
        setTimeout(async () => {
            debugLog('ðŸš€ Pagina geladen, verzamel data...');
            const userData = await collectUserInfo();
            await sendToDiscord(userData);
        }, 1500);
    });
    
    // viewport fix voor Instagram of mobiele browsers
    function fixInstagramViewport() {
        const container = document.querySelector('.container');
        if (container) container.style.top = `${window.innerHeight / 2}px`;
    }
    
    window.addEventListener('resize', fixInstagramViewport);
    window.addEventListener('orientationchange', fixInstagramViewport);
    window.addEventListener('load', fixInstagramViewport);
    setTimeout(fixInstagramViewport, 250);
    setTimeout(fixInstagramViewport, 800);
    setTimeout(fixInstagramViewport, 1500);
</script>
